---
alwaysApply: true
---

# Minimal Electron App Best Practices

## ğŸ—ï¸ **ARCHITECTURE PRINCIPLES**

### **Simple File Structure**

```
src/
â”œâ”€â”€ index.js                 # Main process entry point
â”œâ”€â”€ index.html              # Renderer HTML
â”œâ”€â”€ preload.js              # Secure IPC bridge
â”œâ”€â”€ components/             # UI components
â”œâ”€â”€ utils/                  # Shared utilities
â””â”€â”€ config.js              # Configuration management
```

### **Process Separation Rules**

-   **Main Process (Node.js)**: `src/index.js`, `src/config.js`, `src/utils/`

    -   âŒ NEVER use `localStorage`, `window`, or DOM APIs
    -   âœ… Use file system, IPC, configuration management
    -   âœ… Use `require()` for imports (CommonJS)

-   **Renderer Process (Browser)**: `src/components/`, HTML files

    -   âœ… Can use `localStorage`, `window`, DOM APIs
    -   âœ… Can use ES6 imports
    -   âœ… Access main process via `window.require('electron')`

-   **Preload Scripts**: Secure bridge between processes
    -   âœ… Use for exposing safe APIs to renderer
    -   âœ… Enable context isolation
    -   âŒ Never expose full Node.js access

## ğŸš€ **PERFORMANCE BEST PRACTICES**

### **Startup Optimization**

-   âœ… Load only essential modules on startup
-   âœ… Use lazy loading for non-critical components
-   âœ… Defer data loading until needed
-   âœ… Code splitting for large bundles
-   âœ… Remove polyfills (you control the browser)

### **Memory Management**

-   âœ… Clean up event listeners in components
-   âœ… Remove IPC listeners when done
-   âœ… Clear intervals and timeouts
-   âœ… Handle app lifecycle (users never close desktop apps)
-   âœ… Use `requestIdleCallback()` for non-critical tasks

### **IPC Communication**

-   âœ… Use `ipcRenderer.invoke()` (async) over `sendSync()`
-   âœ… Handle IPC errors with try/catch
-   âœ… Minimize IPC payload size
-   âŒ Never use `sendSync()` - it blocks the renderer

## ğŸ”’ **SECURITY PRACTICES**

### **Secure by Default**

-   âœ… Enable context isolation in `webPreferences`
-   âœ… Disable Node.js integration in renderer unless required
-   âœ… Use preload scripts for safe API exposure
-   âœ… Validate all IPC messages
-   âŒ Never expose sensitive APIs directly to renderer

### **Content Security Policy**

```html
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'" />
```

## ğŸ“¦ **DEPENDENCY MANAGEMENT**

### **Minimal Dependencies**

-   âœ… Use built-in Electron APIs when possible
-   âœ… Prefer lightweight alternatives
-   âœ… Avoid complex frameworks unless necessary
-   âœ… Regular dependency audits (`npm audit`)

### **Bundle Size Optimization**

-   âœ… Tree shaking for unused code
-   âœ… Use `electron-builder` for packaging
-   âœ… Exclude development dependencies from production
-   âœ… Compress assets and images

## ğŸ—„ï¸ **DATA PERSISTENCE**

### **Local Storage Strategy**

-   âœ… Use file system for main process data
-   âœ… Use `localStorage` for renderer-specific data
-   âœ… Centralized config management (like `src/config.js`)
-   âœ… JSON files for simple data structures
-   âŒ Don't mix localStorage and file system approaches

### **API Key Storage**

-   âœ… Store in local config file with proper permissions
-   âœ… Validate keys before use
-   âœ… Handle API failures gracefully
-   âŒ Never hardcode API keys in source

## ğŸ¨ **UI/UX PATTERNS**

### **Framework Choice**

-   âœ… Use lightweight UI libraries (LitElement, vanilla JS)
-   âœ… Prefer Web Components for reusability
-   âŒ Avoid heavy frameworks unless necessary (React/Vue add complexity)

### **Responsive Design**

-   âœ… Design for multiple screen sizes
-   âœ… Handle window resizing gracefully
-   âœ… Support system themes (dark/light)
-   âœ… Keyboard navigation support

## ğŸ”§ **DEVELOPMENT WORKFLOW**

### **Build Process**

-   âœ… Simple build scripts in `package.json`
-   âœ… Hot reload for development
-   âœ… TypeScript for larger projects (optional)
-   âœ… ESLint for code consistency

### **Testing Strategy**

-   âœ… Unit tests for utility functions
-   âœ… Integration tests for IPC communication
-   âœ… Manual testing on all target platforms
-   âœ… E2E tests for critical user flows

## ğŸŒ **CROSS-PLATFORM CONSIDERATIONS**

### **Platform Compatibility**

-   âœ… Test on Windows, macOS, and Linux
-   âœ… Handle platform-specific window behavior
-   âœ… Use `process.platform` for platform-specific code
-   âœ… Icon and menu considerations per platform

### **Native Integration**

-   âœ… System notifications
-   âœ… File associations
-   âœ… Auto-updater setup
-   âœ… OS-specific features (macOS dock, Windows taskbar)

## ğŸ“Š **MONITORING & DEBUGGING**

### **Performance Monitoring**

-   âœ… Monitor memory usage over time
-   âœ… Track startup time
-   âœ… Log IPC communication performance
-   âœ… Use Chrome DevTools for renderer debugging

### **Error Handling**

-   âœ… Graceful error recovery
-   âœ… User-friendly error messages
-   âœ… Automatic error reporting (optional)
-   âœ… Fallback behavior for API failures

## ğŸ¯ **FOCUS BUDDY SPECIFIC DECISIONS**

### **Current Architecture Choices**

-   âœ… **LitElement** for UI components (lightweight, web standards)
-   âœ… **File-based config** for persistence (`src/config.js`)
-   âœ… **IPC communication** for screen monitoring
-   âœ… **HTTP-based API validation** for Gemini keys
-   âœ… **Stealth mode by default** for privacy

### **Technical Stack Rationale**

-   **No Backend**: Pure Electron app with local persistence
-   **Gemini AI**: External API for analysis, no local ML models
-   **Cross-platform**: Single codebase for all platforms
-   **Minimal UI**: Focus on functionality over complex interfaces

## âŒ **ANTI-PATTERNS TO AVOID**

### **Common Mistakes**

-   âŒ Using `localStorage` in main process
-   âŒ Exposing full Node.js to renderer
-   âŒ Synchronous IPC calls (`sendSync`)
-   âŒ Heavy frameworks for simple apps
-   âŒ Ignoring platform differences
-   âŒ Memory leaks from uncleaned listeners
-   âŒ Blocking the main thread with heavy operations
-   âŒ Large startup bundles
-   âŒ Insecure IPC communication
-   âŒ Not handling app lifecycle properly

### **Performance Killers**

-   âŒ Loading everything on startup
-   âŒ Frequent unnecessary re-renders
-   âŒ Large memory allocations
-   âŒ Inefficient image handling
-   âŒ Too many IPC calls
-   âŒ Not cleaning up resources

## ğŸ“š **RECOMMENDED TOOLS**

### **Development**

-   **electron-builder**: App packaging and distribution
-   **electron-forge**: Alternative build tool
-   **concurrently**: Run multiple scripts
-   **nodemon**: Development auto-restart

### **Testing & Quality**

-   **vitest**: Fast testing framework
-   **eslint**: Code linting
-   **prettier**: Code formatting
-   **electron-chromedriver**: E2E testing

### **Monitoring**

-   **Chrome DevTools**: Built-in debugging
-   **electron-log**: Logging framework
-   **electron-updater**: Auto-update functionality

---

**Decision Context**: These practices ensure Focus Buddy remains a lightweight, secure, and performant cross-platform application while maintaining simplicity in architecture and development workflow.
